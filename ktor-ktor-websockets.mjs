import {
  collectionSizeOrDefault36dulx8yinfqm as collectionSizeOrDefault,
  mapCapacity1h45rc3eh9p2l as mapCapacity,
  coerceAtLeast2bkz8m9ik7hep as coerceAtLeast,
  LinkedHashMap1zhqxkxv3xnkl as LinkedHashMap,
  Unit_instance28fytmsmm6r23 as Unit_instance,
  initMetadataForCompanion1wyw17z38v6ac as initMetadataForCompanion,
  VOID3gxj6tk5isa35 as VOID,
  enumEntries20mr21zbe3az4 as enumEntries,
  Enum3alwj03lh1n41 as Enum,
  initMetadataForClassbxx6q50dy2s7 as initMetadataForClass,
  createThis2j2avj17cvnv2 as createThis,
  toString1pkumu07cwy4m as toString,
  getStringHashCode26igk1bx568vk as getStringHashCode,
  initMetadataForInterface1egvbzx539z91 as initMetadataForInterface,
  isInterface3d6p8outrmvmk as isInterface,
  IllegalArgumentException2asla15b5jaob as IllegalArgumentException,
  get_COROUTINE_SUSPENDED3ujt3p13qm4iy as get_COROUTINE_SUSPENDED,
  ensureNotNull1e947j3ixpazm as ensureNotNull,
  CancellationException3b36o9qz53rgr as CancellationException,
  suspendOrReturn49pspzlx5djv as suspendOrReturn,
  toString30pk9tzaqopn as toString_0,
  fromInt2ii0rejb1w62w as fromInt,
  THROW_CCE2g6jy02ryeudk as THROW_CCE,
  initMetadataForLambda3af3he42mmnh as initMetadataForLambda,
  ArrayList3it5z8td81qkl as ArrayList,
  IllegalStateExceptionkoljg5n0nrlr as IllegalStateException,
  joinToString1cxrrlmo0chqs as joinToString,
  protoOf180f3jzyo7rfj as protoOf,
  initMetadataForObject1cxne3s9w65el as initMetadataForObject,
  Exceptiondt2hlxn7j7vw as Exception,
  captureStack1fzi4aczwc4hg as captureStack,
  compareTo3ankvs086tmwq as compareTo,
  decodeToString1dbzcjd620q25 as decodeToString,
  Randomei1bbeye8rr8 as Random,
  throwUninitializedPropertyAccessException14fok093f3k3t as throwUninitializedPropertyAccessException,
  RuntimeException1r3t0zl97011n as RuntimeException,
  split2bvyvnrlcifjv as split,
  first58ocm7j58k3q as first,
  isCharSequence1ju9jr1w86plq as isCharSequence,
  trim11nh7r46at6sx as trim,
  drop3na99dw9feawf as drop,
  noWhenBranchMatchedException2a6r7ubxgky5j as noWhenBranchMatchedException,
} from './kotlin-kotlin-stdlib.mjs';
import {
  get_isTraceEnabled82xibuu04nxp as get_isTraceEnabled,
  ChannelIOException2i3t76lsrbgox as ChannelIOException,
  KtorSimpleLogger1xdphsp5l4e48 as KtorSimpleLogger,
  initCauseBridge1upxfqhavblt6 as initCauseBridge,
  getTimeMillis12o7k17x9fmwi as getTimeMillis,
  hex2ofqpe9ngcu1i as hex,
} from './ktor-ktor-utils.mjs';
import {
  BytePacketBuilder2biodf4wxvlba as BytePacketBuilder,
  writeFully359t6q8kam2g5 as writeFully,
  buildjygoh729rhy8 as build,
  get_size2imoy2jq11jxl as get_size,
  Charsets_getInstanceq0o82sizm30g as Charsets_getInstance,
  decode1t43jmuxrxpmo as decode,
  readText27783kyxjxi1g as readText,
  toByteArray1i3ns5jnoqlv6 as toByteArray,
  ClosedByteChannelException3il8gfpye60w as ClosedByteChannelException,
  writeText19qfzm98fbm4l as writeText,
} from './ktor-ktor-io.mjs';
import {
  readByteArray1ri21h2rciakw as readByteArray,
  IOException1wyutdmfe71nu as IOException,
  Buffergs925ekssbch as Buffer,
} from './kotlinx-io-kotlinx-io-core.mjs';
import {
  cancelConsumed2i0oizqhmljf6 as cancelConsumed,
  ClosedSendChannelException29m33prpq9jaw as ClosedSendChannelException,
  ClosedReceiveChannelException3ofg6gf5f5b38 as ClosedReceiveChannelException,
  Dispatchers_getInstancewbokwrm9sosb as Dispatchers_getInstance,
  launch1c91vkjzdi9sd as launch,
  CoroutineStart_UNDISPATCHED_getInstanceldihd7d5m0an as CoroutineStart_UNDISPATCHED_getInstance,
  ChannelResult2y4k69ac6y3du as ChannelResult,
  _ChannelResult___get_isSuccess__impl__odq1z9363u9zgwpgg09 as _ChannelResult___get_isSuccess__impl__odq1z9,
  CoroutineScopefcb5f5dwqcas as CoroutineScope,
  CompletableDeferred2lnqvsbvx74d3 as CompletableDeferred,
  Job13y4jkazwjho0 as Job,
  Key_instance17dpgmdbeabno as Key_instance,
  CoroutineName2g5zosw74tf0f as CoroutineName,
  Factory_getInstance1n4mqriubejsu as Factory_getInstance,
  CopyableThrowable1mvc99jcyvivf as CopyableThrowable,
  Channel3r72atmcithql as Channel,
  withTimeoutOrNullod8v51lxlhk as withTimeoutOrNull,
  BufferOverflow_SUSPEND_getInstance31wn3v83onf3w as BufferOverflow_SUSPEND_getInstance,
  BufferOverflow_DROP_OLDEST_getInstance19p135qqjnhf2 as BufferOverflow_DROP_OLDEST_getInstance,
  _ChannelResult___get_isClosed__impl__mg7kuu1xlv81pnrlsg7 as _ChannelResult___get_isClosed__impl__mg7kuu,
  close$default29t9kascifp5w as close$default,
  cancel$default3ekkkwpkem73o as cancel$default,
  SendChannel38sllbxw662ws as SendChannel,
  ReceiveChannel24wu5e2tj9lbp as ReceiveChannel,
} from './kotlinx-coroutines-core.mjs';
import {
  atomic$ref$130aurmcwdfdf1 as atomic$ref$1,
  atomic$boolean$1iggki4z65a2h as atomic$boolean$1,
} from './kotlinx-atomicfu.mjs';
//region block: imports
var imul = Math.imul;
//endregion
//region block: pre-declaration
class Companion {
  constructor() {
    Companion_instance = this;
    var tmp = this;
    // Inline function 'kotlin.collections.associateBy' call
    var this_0 = get_entries();
    var capacity = coerceAtLeast(mapCapacity(collectionSizeOrDefault(this_0, 10)), 16);
    // Inline function 'kotlin.collections.associateByTo' call
    var destination = LinkedHashMap.mc(capacity);
    var _iterator__ex2g4s = this_0.q1();
    while (_iterator__ex2g4s.r1()) {
      var element = _iterator__ex2g4s.s1();
      var tmp$ret$0 = element.e30_1;
      destination.k4(tmp$ret$0, element);
    }
    tmp.f30_1 = destination;
    this.g30_1 = Codes_INTERNAL_ERROR_getInstance();
  }
  h30(code) {
    return this.f30_1.h4(code);
  }
}
class Codes extends Enum {
  constructor(name, ordinal, code) {
    super(name, ordinal);
    this.e30_1 = code;
  }
}
class CloseReason {
  static k30(code, message) {
    var $this = createThis(this);
    $this.i30_1 = code;
    $this.j30_1 = message;
    return $this;
  }
  static l30(code, message) {
    return this.k30(code.e30_1, message);
  }
  m30() {
    return Companion_getInstance().h30(this.i30_1);
  }
  toString() {
    var tmp0_elvis_lhs = this.m30();
    return 'CloseReason(reason=' + toString(tmp0_elvis_lhs == null ? this.i30_1 : tmp0_elvis_lhs) + ', message=' + this.j30_1 + ')';
  }
  hashCode() {
    var result = this.i30_1;
    result = imul(result, 31) + getStringHashCode(this.j30_1) | 0;
    return result;
  }
  equals(other) {
    if (this === other)
      return true;
    if (!(other instanceof CloseReason))
      return false;
    if (!(this.i30_1 === other.i30_1))
      return false;
    if (!(this.j30_1 === other.j30_1))
      return false;
    return true;
  }
}
class WebSocketSession {}
function send(frame, $completion) {
  return suspendOrReturn(/*#__NOINLINE__*/_generator_send__qhx0g0_0.bind(VOID, this, frame), $completion);
}
class DefaultWebSocketSession {}
class Companion_0 {
  constructor() {
    Companion_instance_0 = this;
    this.h32_1 = Pong.w32(new Int8Array(0), NonDisposableHandle_instance);
  }
}
class DefaultWebSocketSessionImpl$start$slambda {
  constructor($incomingJob, $outgoingJob, this$0) {
    this.w30_1 = $incomingJob;
    this.x30_1 = $outgoingJob;
    this.y30_1 = this$0;
  }
  l29($this$launch, $completion) {
    return suspendOrReturn(/*#__NOINLINE__*/_generator_invoke__zhh2q8.bind(VOID, this, $this$launch), $completion);
  }
  yd(p1, $completion) {
    return this.l29((!(p1 == null) ? isInterface(p1, CoroutineScope) : false) ? p1 : THROW_CCE(), $completion);
  }
}
class DefaultWebSocketSessionImpl$runIncomingProcessor$slambda {
  constructor(this$0, $ponger) {
    this.m31_1 = this$0;
    this.n31_1 = $ponger;
  }
  l29($this$launch, $completion) {
    return suspendOrReturn(/*#__NOINLINE__*/_generator_invoke__zhh2q8_0.bind(VOID, this, $this$launch), $completion);
  }
  yd(p1, $completion) {
    return this.l29((!(p1 == null) ? isInterface(p1, CoroutineScope) : false) ? p1 : THROW_CCE(), $completion);
  }
}
class DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda {
  constructor(this$0) {
    this.f32_1 = this$0;
  }
  l29($this$launch, $completion) {
    return suspendOrReturn(/*#__NOINLINE__*/_generator_invoke__zhh2q8_1.bind(VOID, this, $this$launch), $completion);
  }
  yd(p1, $completion) {
    return this.l29((!(p1 == null) ? isInterface(p1, CoroutineScope) : false) ? p1 : THROW_CCE(), $completion);
  }
}
class DefaultWebSocketSessionImpl$runOrCancelPinger$slambda {
  constructor(this$0) {
    this.g32_1 = this$0;
  }
  x32(it, $completion) {
    return suspendOrReturn(/*#__NOINLINE__*/_generator_invoke__zhh2q8_2.bind(VOID, this, it), $completion);
  }
  yd(p1, $completion) {
    return this.x32(p1 instanceof CloseReason ? p1 : THROW_CCE(), $completion);
  }
}
class DefaultWebSocketSessionImpl {
  constructor(raw, pingIntervalMillis, timeoutMillis, incomingFramesConfig, outgoingFramesConfig) {
    Companion_getInstance_0();
    this.z30_1 = raw;
    this.a31_1 = atomic$ref$1(null);
    this.b31_1 = CompletableDeferred();
    this.c31_1 = Job();
    this.d31_1 = this.z30_1.c1n().om(Key_instance).qm(this.c31_1).qm(new CoroutineName('ws-default'));
    this.e31_1 = from(Factory_getInstance(), incomingFramesConfig);
    this.f31_1 = from(Factory_getInstance(), outgoingFramesConfig);
    this.g31_1 = atomic$boolean$1(false);
    var tmp = this;
    // Inline function 'kotlin.collections.mutableListOf' call
    tmp.h31_1 = ArrayList.s2();
    this.i31_1 = atomic$boolean$1(false);
    this.j31_1 = pingIntervalMillis;
    this.k31_1 = timeoutMillis;
    this.l31_1 = this.b31_1;
  }
  c1n() {
    return this.d31_1;
  }
  q30() {
    return this.e31_1;
  }
  r30() {
    return this.f31_1;
  }
  m32() {
    return this.h31_1;
  }
  o30(value) {
    this.z30_1.o30(value);
  }
  p30() {
    return this.z30_1.p30();
  }
  n30(negotiatedExtensions) {
    if (!this.i31_1.atomicfu$compareAndSet(false, true)) {
      // Inline function 'kotlin.error' call
      var message = 'WebSocket session ' + toString(this) + ' is already started.';
      throw IllegalStateException.o(toString(message));
    }
    // Inline function 'io.ktor.util.logging.trace' call
    var this_0 = get_LOGGER();
    if (get_isTraceEnabled(this_0)) {
      var tmp$ret$0 = 'Starting default WebSocketSession(' + toString(this) + ') ' + ('with negotiated extensions: ' + joinToString(negotiatedExtensions));
      this_0.j2h(tmp$ret$0);
    }
    this.h31_1.r2(negotiatedExtensions);
    runOrCancelPinger(this);
    var incomingJob = runIncomingProcessor(this, ponger(this, this.r30()));
    var outgoingJob = runOutgoingProcessor(this);
    launch(this, VOID, VOID, DefaultWebSocketSessionImpl$start$slambda_0(incomingJob, outgoingJob, this));
  }
  n27($completion) {
    return suspendOrReturn(/*#__NOINLINE__*/_generator_flush__owbk1c.bind(VOID, this), $completion);
  }
}
class NonDisposableHandle {
  p1q() {
    return Unit_instance;
  }
  toString() {
    return 'NonDisposableHandle';
  }
  hashCode() {
    return 207988788;
  }
  equals(other) {
    if (this === other)
      return true;
    if (!(other instanceof NonDisposableHandle))
      return false;
    return true;
  }
}
class FrameTooBigException extends Exception {
  static l32(frameSize) {
    var $this = this.le();
    captureStack($this, $this.k32_1);
    $this.j32_1 = frameSize;
    delete $this.message;
    return $this;
  }
  r() {
    return 'Frame is too big: ' + this.j32_1.toString();
  }
  b1u() {
    // Inline function 'kotlin.also' call
    var this_0 = FrameTooBigException.l32(this.j32_1);
    initCauseBridge(this_0, this);
    return this_0;
  }
  get message() {
    return this.r();
  }
}
class Companion_1 {
  constructor() {
    Companion_instance_1 = this;
    var tmp = this;
    var tmp0 = get_entries_0();
    var tmp$ret$0;
    $l$block_0: {
      // Inline function 'kotlin.collections.maxByOrNull' call
      var iterator = tmp0.q1();
      if (!iterator.r1()) {
        tmp$ret$0 = null;
        break $l$block_0;
      }
      var maxElem = iterator.s1();
      if (!iterator.r1()) {
        tmp$ret$0 = maxElem;
        break $l$block_0;
      }
      var maxValue = maxElem.b33_1;
      do {
        var e = iterator.s1();
        var v = e.b33_1;
        if (compareTo(maxValue, v) < 0) {
          maxElem = e;
          maxValue = v;
        }
      }
       while (iterator.r1());
      tmp$ret$0 = maxElem;
    }
    tmp.c33_1 = ensureNotNull(tmp$ret$0).b33_1;
    var tmp_0 = this;
    var tmp_1 = 0;
    var tmp_2 = this.c33_1 + 1 | 0;
    // Inline function 'kotlin.arrayOfNulls' call
    var tmp_3 = Array(tmp_2);
    while (tmp_1 < tmp_2) {
      var tmp_4 = tmp_1;
      var tmp0_0 = get_entries_0();
      var tmp$ret$5;
      $l$block_2: {
        // Inline function 'kotlin.collections.singleOrNull' call
        var single = null;
        var found = false;
        var _iterator__ex2g4s = tmp0_0.q1();
        while (_iterator__ex2g4s.r1()) {
          var element = _iterator__ex2g4s.s1();
          if (element.b33_1 === tmp_4) {
            if (found) {
              tmp$ret$5 = null;
              break $l$block_2;
            }
            single = element;
            found = true;
          }
        }
        if (!found) {
          tmp$ret$5 = null;
          break $l$block_2;
        }
        tmp$ret$5 = single;
      }
      tmp_3[tmp_4] = tmp$ret$5;
      tmp_1 = tmp_1 + 1 | 0;
    }
    tmp_0.d33_1 = tmp_3;
  }
}
class FrameType extends Enum {
  constructor(name, ordinal, controlFrame, opcode) {
    super(name, ordinal);
    this.a33_1 = controlFrame;
    this.b33_1 = opcode;
  }
}
class ponger$slambda {
  constructor($channel, $outgoing) {
    this.e33_1 = $channel;
    this.f33_1 = $outgoing;
  }
  l29($this$launch, $completion) {
    return suspendOrReturn(/*#__NOINLINE__*/_generator_invoke__zhh2q8_3.bind(VOID, this, $this$launch), $completion);
  }
  yd(p1, $completion) {
    return this.l29((!(p1 == null) ? isInterface(p1, CoroutineScope) : false) ? p1 : THROW_CCE(), $completion);
  }
}
class pinger$slambda$slambda {
  constructor($channel) {
    this.g33_1 = $channel;
  }
  l29($this$withTimeoutOrNull, $completion) {
    return suspendOrReturn(/*#__NOINLINE__*/_generator_invoke__zhh2q8_4.bind(VOID, this, $this$withTimeoutOrNull), $completion);
  }
  yd(p1, $completion) {
    return this.l29((!(p1 == null) ? isInterface(p1, CoroutineScope) : false) ? p1 : THROW_CCE(), $completion);
  }
}
class pinger$slambda$slambda_0 {
  constructor($outgoing, $pingMessage, $channel) {
    this.h33_1 = $outgoing;
    this.i33_1 = $pingMessage;
    this.j33_1 = $channel;
  }
  l29($this$withTimeoutOrNull, $completion) {
    return suspendOrReturn(/*#__NOINLINE__*/_generator_invoke__zhh2q8_5.bind(VOID, this, $this$withTimeoutOrNull), $completion);
  }
  yd(p1, $completion) {
    return this.l29((!(p1 == null) ? isInterface(p1, CoroutineScope) : false) ? p1 : THROW_CCE(), $completion);
  }
}
class pinger$slambda {
  constructor($periodMillis, $timeoutMillis, $onTimeout, $channel, $outgoing) {
    this.s33_1 = $periodMillis;
    this.t33_1 = $timeoutMillis;
    this.u33_1 = $onTimeout;
    this.v33_1 = $channel;
    this.w33_1 = $outgoing;
  }
  l29($this$launch, $completion) {
    return suspendOrReturn(/*#__NOINLINE__*/_generator_invoke__zhh2q8_6.bind(VOID, this, $this$launch), $completion);
  }
  yd(p1, $completion) {
    return this.l29((!(p1 == null) ? isInterface(p1, CoroutineScope) : false) ? p1 : THROW_CCE(), $completion);
  }
}
class Companion_2 {
  constructor() {
    Companion_instance_2 = this;
    var tmp = this;
    // Inline function 'kotlin.apply' call
    var this_0 = new WebSocketChannelsConfig();
    this_0.u30_1 = this_0.x33();
    this_0.v30_1 = this_0.x33();
    tmp.t30_1 = this_0;
  }
}
class WebSocketChannelsConfig {
  constructor() {
    Companion_getInstance_2();
    this.u30_1 = Companion_getInstance_3().y33_1;
    this.v30_1 = Companion_getInstance_3().y33_1;
  }
  x33() {
    return Companion_getInstance_3().y33_1;
  }
}
class Companion_3 {
  constructor() {
    Companion_instance_3 = this;
    this.y33_1 = new ChannelConfig(2147483647, ChannelOverflow_SUSPEND_getInstance());
  }
}
class ChannelConfig {
  constructor(capacity, onOverflow) {
    Companion_getInstance_3();
    this.z33_1 = capacity;
    this.a34_1 = onOverflow;
  }
  b34() {
    return this.a34_1.equals(ChannelOverflow_SUSPEND_getInstance()) && !(this.z33_1 === 2147483647);
  }
}
class ChannelOverflow extends Enum {}
class Companion_4 {
  g34(capacity) {
    var channel = {_v: null};
    var tmp = BufferOverflow_DROP_OLDEST_getInstance();
    // Inline function 'kotlin.also' call
    var this_0 = Channel(capacity, tmp, BoundedChannel$Companion$createDelegate$lambda(channel));
    channel._v = this_0;
    return this_0;
  }
}
class BoundedChannel {
  constructor(capacity, delegate) {
    delegate = delegate === VOID ? Companion_instance_4.g34(capacity) : delegate;
    this.h34_1 = delegate;
  }
  i34(element) {
    var result = this.h34_1.w21(element);
    if (!_ChannelResult___get_isSuccess__impl__odq1z9(result) && !_ChannelResult___get_isClosed__impl__mg7kuu(result)) {
      this.g22(ChannelOverflowException.f34('Channel overflowed'));
    }
    return result;
  }
  w21(element) {
    return this.i34((element == null ? true : !(element == null)) ? element : THROW_CCE());
  }
  j34(element, $completion) {
    return suspendOrReturn(/*#__NOINLINE__*/_generator_send__qhx0g0.bind(VOID, this, element), $completion);
  }
  v21(element, $completion) {
    return this.j34((element == null ? true : !(element == null)) ? element : THROW_CCE(), $completion);
  }
  g22(cause) {
    return this.h34_1.g22(cause);
  }
  o21() {
    return this.h34_1.o21();
  }
  z21($completion) {
    return this.h34_1.z21($completion);
  }
  q1() {
    return this.h34_1.q1();
  }
  l1o(cause) {
    this.h34_1.l1o(cause);
  }
}
class ChannelOverflowException extends RuntimeException {
  static f34(message) {
    var $this = this.fb(message);
    captureStack($this, $this.e34_1);
    return $this;
  }
}
class WebSocketExtension {}
class WebSocketExtensionsConfig {
  constructor() {
    var tmp = this;
    // Inline function 'kotlin.collections.mutableListOf' call
    tmp.m34_1 = ArrayList.s2();
    var tmp_0 = this;
    // Inline function 'kotlin.arrayOf' call
    // Inline function 'kotlin.js.unsafeCast' call
    // Inline function 'kotlin.js.asDynamic' call
    tmp_0.n34_1 = [false, false, false];
  }
  h2l() {
    // Inline function 'kotlin.collections.map' call
    var this_0 = this.m34_1;
    // Inline function 'kotlin.collections.mapTo' call
    var destination = ArrayList.d2(collectionSizeOrDefault(this_0, 10));
    var _iterator__ex2g4s = this_0.q1();
    while (_iterator__ex2g4s.r1()) {
      var item = _iterator__ex2g4s.s1();
      var tmp$ret$0 = item();
      destination.e2(tmp$ret$0);
    }
    return destination;
  }
}
class WebSocketExtensionHeader {
  constructor(name, parameters) {
    this.o34_1 = name;
    this.p34_1 = parameters;
  }
  toString() {
    return this.o34_1 + ' ' + parametersToString(this);
  }
}
class Frame {
  static y34(fin, frameType, data, disposableHandle, rsv1, rsv2, rsv3) {
    Companion_getInstance_5();
    disposableHandle = disposableHandle === VOID ? NonDisposableHandle_instance : disposableHandle;
    rsv1 = rsv1 === VOID ? false : rsv1;
    rsv2 = rsv2 === VOID ? false : rsv2;
    rsv3 = rsv3 === VOID ? false : rsv3;
    var $this = createThis(this);
    $this.o31_1 = fin;
    $this.p31_1 = frameType;
    $this.q31_1 = data;
    $this.r31_1 = disposableHandle;
    $this.s31_1 = rsv1;
    $this.t31_1 = rsv2;
    $this.u31_1 = rsv3;
    return $this;
  }
  toString() {
    return 'Frame ' + this.p31_1.toString() + ' (fin=' + this.o31_1 + ', buffer len = ' + this.q31_1.length + ')';
  }
}
class Binary extends Frame {
  static x34(fin, data, rsv1, rsv2, rsv3) {
    rsv1 = rsv1 === VOID ? false : rsv1;
    rsv2 = rsv2 === VOID ? false : rsv2;
    rsv3 = rsv3 === VOID ? false : rsv3;
    return this.y34(fin, FrameType_BINARY_getInstance(), data, NonDisposableHandle_instance, rsv1, rsv2, rsv3);
  }
  static z34(fin, data) {
    return this.x34(fin, data, false, false, false);
  }
}
class Text extends Frame {
  static h35(fin, data, rsv1, rsv2, rsv3) {
    rsv1 = rsv1 === VOID ? false : rsv1;
    rsv2 = rsv2 === VOID ? false : rsv2;
    rsv3 = rsv3 === VOID ? false : rsv3;
    return this.y34(fin, FrameType_TEXT_getInstance(), data, NonDisposableHandle_instance, rsv1, rsv2, rsv3);
  }
  static i35(fin, data) {
    return this.h35(fin, data, false, false, false);
  }
  static j35(text) {
    return this.i35(true, toByteArray(text));
  }
}
class Close extends Frame {
  static k35(data) {
    return this.y34(true, FrameType_CLOSE_getInstance(), data, NonDisposableHandle_instance, false, false, false);
  }
  static e32(reason) {
    // Inline function 'io.ktor.utils.io.core.buildPacket' call
    var builder = new Buffer();
    builder.e1l(reason.i30_1);
    writeText(builder, reason.j30_1);
    return this.l35(builder);
  }
  static l35(packet) {
    return this.k35(readByteArray(packet));
  }
  static m35() {
    return this.k35(Companion_getInstance_5().v31_1);
  }
}
class Ping extends Frame {
  static r33(data) {
    return this.y34(true, FrameType_PING_getInstance(), data, NonDisposableHandle_instance, false, false, false);
  }
}
class Pong extends Frame {
  static w32(data, disposableHandle) {
    disposableHandle = disposableHandle === VOID ? NonDisposableHandle_instance : disposableHandle;
    return this.y34(true, FrameType_PONG_getInstance(), data, disposableHandle, false, false, false);
  }
}
class Companion_5 {
  constructor() {
    Companion_instance_5 = this;
    this.v31_1 = new Int8Array(0);
  }
  w31(fin, frameType, data, rsv1, rsv2, rsv3) {
    var tmp;
    switch (frameType.x1_1) {
      case 1:
        tmp = Binary.x34(fin, data, rsv1, rsv2, rsv3);
        break;
      case 0:
        tmp = Text.h35(fin, data, rsv1, rsv2, rsv3);
        break;
      case 2:
        tmp = Close.k35(data);
        break;
      case 3:
        tmp = Ping.r33(data);
        break;
      case 4:
        tmp = Pong.w32(data, NonDisposableHandle_instance);
        break;
      default:
        noWhenBranchMatchedException();
        break;
    }
    return tmp;
  }
}
//endregion
var Codes_NORMAL_instance;
var Codes_GOING_AWAY_instance;
var Codes_PROTOCOL_ERROR_instance;
var Codes_CANNOT_ACCEPT_instance;
var Codes_CLOSED_ABNORMALLY_instance;
var Codes_NOT_CONSISTENT_instance;
var Codes_VIOLATED_POLICY_instance;
var Codes_TOO_BIG_instance;
var Codes_NO_EXTENSION_instance;
var Codes_INTERNAL_ERROR_instance;
var Codes_SERVICE_RESTART_instance;
var Codes_TRY_AGAIN_LATER_instance;
var Companion_instance;
function Companion_getInstance() {
  Codes_initEntries();
  if (Companion_instance === VOID)
    new Companion();
  return Companion_instance;
}
function values() {
  return [Codes_NORMAL_getInstance(), Codes_GOING_AWAY_getInstance(), Codes_PROTOCOL_ERROR_getInstance(), Codes_CANNOT_ACCEPT_getInstance(), Codes_CLOSED_ABNORMALLY_getInstance(), Codes_NOT_CONSISTENT_getInstance(), Codes_VIOLATED_POLICY_getInstance(), Codes_TOO_BIG_getInstance(), Codes_NO_EXTENSION_getInstance(), Codes_INTERNAL_ERROR_getInstance(), Codes_SERVICE_RESTART_getInstance(), Codes_TRY_AGAIN_LATER_getInstance()];
}
function get_entries() {
  if ($ENTRIES == null)
    $ENTRIES = enumEntries(values());
  return $ENTRIES;
}
var Codes_entriesInitialized;
function Codes_initEntries() {
  if (Codes_entriesInitialized)
    return Unit_instance;
  Codes_entriesInitialized = true;
  Codes_NORMAL_instance = new Codes('NORMAL', 0, 1000);
  Codes_GOING_AWAY_instance = new Codes('GOING_AWAY', 1, 1001);
  Codes_PROTOCOL_ERROR_instance = new Codes('PROTOCOL_ERROR', 2, 1002);
  Codes_CANNOT_ACCEPT_instance = new Codes('CANNOT_ACCEPT', 3, 1003);
  Codes_CLOSED_ABNORMALLY_instance = new Codes('CLOSED_ABNORMALLY', 4, 1006);
  Codes_NOT_CONSISTENT_instance = new Codes('NOT_CONSISTENT', 5, 1007);
  Codes_VIOLATED_POLICY_instance = new Codes('VIOLATED_POLICY', 6, 1008);
  Codes_TOO_BIG_instance = new Codes('TOO_BIG', 7, 1009);
  Codes_NO_EXTENSION_instance = new Codes('NO_EXTENSION', 8, 1010);
  Codes_INTERNAL_ERROR_instance = new Codes('INTERNAL_ERROR', 9, 1011);
  Codes_SERVICE_RESTART_instance = new Codes('SERVICE_RESTART', 10, 1012);
  Codes_TRY_AGAIN_LATER_instance = new Codes('TRY_AGAIN_LATER', 11, 1013);
  Companion_getInstance();
}
var $ENTRIES;
function Codes_NORMAL_getInstance() {
  Codes_initEntries();
  return Codes_NORMAL_instance;
}
function Codes_GOING_AWAY_getInstance() {
  Codes_initEntries();
  return Codes_GOING_AWAY_instance;
}
function Codes_PROTOCOL_ERROR_getInstance() {
  Codes_initEntries();
  return Codes_PROTOCOL_ERROR_instance;
}
function Codes_CANNOT_ACCEPT_getInstance() {
  Codes_initEntries();
  return Codes_CANNOT_ACCEPT_instance;
}
function Codes_CLOSED_ABNORMALLY_getInstance() {
  Codes_initEntries();
  return Codes_CLOSED_ABNORMALLY_instance;
}
function Codes_NOT_CONSISTENT_getInstance() {
  Codes_initEntries();
  return Codes_NOT_CONSISTENT_instance;
}
function Codes_VIOLATED_POLICY_getInstance() {
  Codes_initEntries();
  return Codes_VIOLATED_POLICY_instance;
}
function Codes_TOO_BIG_getInstance() {
  Codes_initEntries();
  return Codes_TOO_BIG_instance;
}
function Codes_NO_EXTENSION_getInstance() {
  Codes_initEntries();
  return Codes_NO_EXTENSION_instance;
}
function Codes_INTERNAL_ERROR_getInstance() {
  Codes_initEntries();
  return Codes_INTERNAL_ERROR_instance;
}
function Codes_SERVICE_RESTART_getInstance() {
  Codes_initEntries();
  return Codes_SERVICE_RESTART_instance;
}
function Codes_TRY_AGAIN_LATER_getInstance() {
  Codes_initEntries();
  return Codes_TRY_AGAIN_LATER_instance;
}
function get_LOGGER() {
  _init_properties_DefaultWebSocketSession_kt__469s0y();
  return LOGGER;
}
var LOGGER;
function get_IncomingProcessorCoroutineName() {
  _init_properties_DefaultWebSocketSession_kt__469s0y();
  return IncomingProcessorCoroutineName;
}
var IncomingProcessorCoroutineName;
function get_OutgoingProcessorCoroutineName() {
  _init_properties_DefaultWebSocketSession_kt__469s0y();
  return OutgoingProcessorCoroutineName;
}
var OutgoingProcessorCoroutineName;
function get_NORMAL_CLOSE() {
  _init_properties_DefaultWebSocketSession_kt__469s0y();
  return NORMAL_CLOSE;
}
var NORMAL_CLOSE;
var OUTGOING_CHANNEL_CONFIG;
function DefaultWebSocketSession_0(session, pingIntervalMillis, timeoutMillis, channelsConfig) {
  pingIntervalMillis = pingIntervalMillis === VOID ? 0n : pingIntervalMillis;
  timeoutMillis = timeoutMillis === VOID ? 15000n : timeoutMillis;
  channelsConfig = channelsConfig === VOID ? Companion_getInstance_2().t30_1 : channelsConfig;
  _init_properties_DefaultWebSocketSession_kt__469s0y();
  // Inline function 'kotlin.require' call
  if (!!isInterface(session, DefaultWebSocketSession)) {
    var message = 'Cannot wrap other DefaultWebSocketSession';
    throw IllegalArgumentException.m2(toString(message));
  }
  return new DefaultWebSocketSessionImpl(session, pingIntervalMillis, timeoutMillis, channelsConfig.u30_1, channelsConfig.v30_1);
}
function *_generator_invoke__zhh2q8($this, $this$launch, $completion) {
  var tmp = $this.w30_1.i1o($completion);
  if (tmp === get_COROUTINE_SUSPENDED())
    tmp = yield tmp;
  var tmp_0 = $this.x30_1.i1o($completion);
  if (tmp_0 === get_COROUTINE_SUSPENDED())
    tmp_0 = yield tmp_0;
  $this.y30_1.c31_1.m1o();
  return Unit_instance;
}
function *_generator_invoke__zhh2q8_0($this, $this$launch, $completion) {
  var firstFrame = null;
  var frameBody = null;
  var closeFramePresented = false;
  try {
    // Inline function 'kotlinx.coroutines.channels.consumeEach' call
    var tmp0 = $this.m31_1.z30_1.q30();
    $l$block_1: {
      // Inline function 'kotlinx.coroutines.channels.consume' call
      var cause = null;
      try {
        var _iterator__ex2g4s = tmp0.q1();
        $l$loop: while (true) {
          var tmp = _iterator__ex2g4s.h21($completion);
          if (tmp === get_COROUTINE_SUSPENDED())
            tmp = yield tmp;
          if (!tmp) {
            break $l$loop;
          }
          var e = _iterator__ex2g4s.s1();
          $l$block_0: {
            // Inline function 'io.ktor.util.logging.trace' call
            var this_0 = get_LOGGER();
            if (get_isTraceEnabled(this_0)) {
              var tmp$ret$0 = 'WebSocketSession(' + toString($this$launch) + ') receiving frame ' + e.toString();
              this_0.j2h(tmp$ret$0);
            }
            if (e instanceof Close) {
              if (!$this.m31_1.r30().o21()) {
                var tmp_0 = $this.m31_1.r30();
                var tmp1_elvis_lhs = readReason(e);
                var tmp_1 = tmp_0.v21(Close.e32(tmp1_elvis_lhs == null ? get_NORMAL_CLOSE() : tmp1_elvis_lhs), $completion);
                if (tmp_1 === get_COROUTINE_SUSPENDED())
                  tmp_1 = yield tmp_1;
              }
              closeFramePresented = true;
              return Unit_instance;
            } else {
              if (e instanceof Pong) {
                var tmp2_safe_receiver = $this.m31_1.a31_1.kotlinx$atomicfu$value;
                if (tmp2_safe_receiver == null)
                  null;
                else {
                  var tmp_2 = tmp2_safe_receiver.v21(e, $completion);
                  if (tmp_2 === get_COROUTINE_SUSPENDED())
                    tmp_2 = yield tmp_2;
                }
              } else {
                if (e instanceof Ping) {
                  var tmp_3 = $this.n31_1.v21(e, $completion);
                  if (tmp_3 === get_COROUTINE_SUSPENDED())
                    tmp_3 = yield tmp_3;
                } else {
                  var tmp_4 = checkMaxFrameSize($this.m31_1, frameBody, e, $completion);
                  if (tmp_4 === get_COROUTINE_SUSPENDED())
                    tmp_4 = yield tmp_4;
                  if (!e.o31_1) {
                    if (firstFrame == null) {
                      firstFrame = e;
                    }
                    if (frameBody == null) {
                      frameBody = BytePacketBuilder();
                    }
                    writeFully(frameBody, e.q31_1);
                    break $l$block_0;
                  }
                  if (firstFrame == null) {
                    var tmp_5 = $this.m31_1.e31_1.v21(processIncomingExtensions($this.m31_1, e), $completion);
                    if (tmp_5 === get_COROUTINE_SUSPENDED())
                      tmp_5 = yield tmp_5;
                    break $l$block_0;
                  }
                  writeFully(ensureNotNull(frameBody), e.q31_1);
                  var defragmented = Companion_getInstance_5().w31(true, firstFrame.p31_1, readByteArray(build(frameBody)), firstFrame.s31_1, firstFrame.t31_1, firstFrame.u31_1);
                  firstFrame = null;
                  var tmp_6 = $this.m31_1.e31_1.v21(processIncomingExtensions($this.m31_1, defragmented), $completion);
                  if (tmp_6 === get_COROUTINE_SUSPENDED())
                    tmp_6 = yield tmp_6;
                }
              }
            }
          }
        }
        break $l$block_1;
      } catch ($p) {
        if ($p instanceof Error) {
          var e_0 = $p;
          cause = e_0;
          throw e_0;
        } else {
          throw $p;
        }
      }
      finally {
        cancelConsumed(tmp0, cause);
      }
    }
  } catch ($p) {
    if ($p instanceof ClosedSendChannelException) {
      var _unused_var__etf5q3 = $p;
    } else {
      if ($p instanceof Error) {
        var cause_0 = $p;
        $this.n31_1.i22();
        $this.m31_1.e31_1.g22(cause_0);
      } else {
        throw $p;
      }
    }
  }
  finally {
    $this.n31_1.i22();
    var tmp0_safe_receiver = frameBody;
    if (tmp0_safe_receiver == null)
      null;
    else {
      tmp0_safe_receiver.e7();
    }
    $this.m31_1.e31_1.i22();
    if (!closeFramePresented) {
      var tmp_7 = close($this.m31_1, CloseReason.l30(Codes_CLOSED_ABNORMALLY_getInstance(), 'Connection was closed without close frame'), $completion);
      if (tmp_7 === get_COROUTINE_SUSPENDED())
        tmp_7 = yield tmp_7;
    }
  }
  return Unit_instance;
}
function *_generator_invoke__zhh2q8_1($this, $this$launch, $completion) {
  try {
    var tmp = outgoingProcessorLoop($this.f32_1, $completion);
    if (tmp === get_COROUTINE_SUSPENDED())
      tmp = yield tmp;
  } catch ($p) {
    if ($p instanceof ClosedSendChannelException) {
      var _unused_var__etf5q3 = $p;
    } else {
      if ($p instanceof ClosedReceiveChannelException) {
        var _unused_var__etf5q3_0 = $p;
      } else {
        if ($p instanceof CancellationException) {
          var _unused_var__etf5q3_1 = $p;
          var tmp_0 = sendCloseSequence$default($this.f32_1, CloseReason.l30(Codes_NORMAL_getInstance(), ''), VOID, $completion);
          if (tmp_0 === get_COROUTINE_SUSPENDED())
            tmp_0 = yield tmp_0;
        } else {
          if ($p instanceof ChannelIOException) {
            var _unused_var__etf5q3_2 = $p;
          } else {
            if ($p instanceof Error) {
              var cause = $p;
              $this.f32_1.f31_1.l1o(CancellationException.p('Failed to send frame', cause));
              var tmp_1 = closeExceptionally($this.f32_1.z30_1, cause, $completion);
              if (tmp_1 === get_COROUTINE_SUSPENDED())
                tmp_1 = yield tmp_1;
              return Unit_instance;
            } else {
              throw $p;
            }
          }
        }
      }
    }
  }
  finally {
    $this.f32_1.f31_1.k22();
    var tmp_2 = close($this.f32_1.z30_1, VOID, $completion);
    if (tmp_2 === get_COROUTINE_SUSPENDED())
      tmp_2 = yield tmp_2;
  }
  return Unit_instance;
}
function *_generator_invoke__zhh2q8_2($this, it, $completion) {
  var tmp = sendCloseSequence($this.g32_1, it, IOException.m1m('Ping timeout'), $completion);
  if (tmp === get_COROUTINE_SUSPENDED())
    tmp = yield tmp;
  return Unit_instance;
}
function *_generator_flush__owbk1c($this, $completion) {
  var tmp = $this.z30_1.n27($completion);
  if (tmp === get_COROUTINE_SUSPENDED())
    tmp = yield tmp;
  return Unit_instance;
}
function runIncomingProcessor($this, ponger) {
  var tmp = get_IncomingProcessorCoroutineName().qm(Dispatchers_getInstance().a1y_1);
  return launch($this, tmp, VOID, DefaultWebSocketSessionImpl$runIncomingProcessor$slambda_0($this, ponger));
}
function runOutgoingProcessor($this) {
  var tmp = get_OutgoingProcessorCoroutineName().qm(Dispatchers_getInstance().a1y_1);
  var tmp_0 = CoroutineStart_UNDISPATCHED_getInstance();
  return launch($this, tmp, tmp_0, DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda_0($this));
}
function *_generator_outgoingProcessorLoop__h1ph7a($this, $completion) {
  var _iterator__ex2g4s = $this.f31_1.q1();
  $l$loop_0: while (true) {
    var tmp = _iterator__ex2g4s.h21($completion);
    if (tmp === get_COROUTINE_SUSPENDED())
      tmp = yield tmp;
    if (!tmp) {
      break $l$loop_0;
    }
    var frame = _iterator__ex2g4s.s1();
    // Inline function 'io.ktor.util.logging.trace' call
    var this_0 = get_LOGGER();
    if (get_isTraceEnabled(this_0)) {
      var tmp$ret$0 = 'Sending ' + frame.toString() + ' from session ' + toString($this);
      this_0.j2h(tmp$ret$0);
    }
    var tmp_0;
    if (frame instanceof Close) {
      var tmp_1 = sendCloseSequence$default($this, readReason(frame), VOID, $completion);
      if (tmp_1 === get_COROUTINE_SUSPENDED())
        tmp_1 = yield tmp_1;
      break $l$loop_0;
    } else {
      var tmp_2;
      if (frame instanceof Text) {
        tmp_2 = true;
      } else {
        tmp_2 = frame instanceof Binary;
      }
      if (tmp_2) {
        tmp_0 = processOutgoingExtensions($this, frame);
      } else {
        tmp_0 = frame;
      }
    }
    var processedFrame = tmp_0;
    var tmp_3 = $this.z30_1.r30().v21(processedFrame, $completion);
    if (tmp_3 === get_COROUTINE_SUSPENDED())
      tmp_3 = yield tmp_3;
  }
  return Unit_instance;
}
function outgoingProcessorLoop($this, $completion) {
  return suspendOrReturn(/*#__NOINLINE__*/_generator_outgoingProcessorLoop__h1ph7a.bind(VOID, $this), $completion);
}
function *_generator_sendCloseSequence__8ec8rh($this, reason, exception, $completion) {
  if (!tryClose($this))
    return Unit_instance;
  // Inline function 'io.ktor.util.logging.trace' call
  var this_0 = get_LOGGER();
  if (get_isTraceEnabled(this_0)) {
    var tmp$ret$0 = 'Sending Close Sequence for session ' + toString($this) + ' with reason ' + toString_0(reason) + ' and exception ' + toString_0(exception);
    this_0.j2h(tmp$ret$0);
  }
  $this.c31_1.q1t();
  var reasonToSend = reason == null ? CloseReason.l30(Codes_NORMAL_getInstance(), '') : reason;
  try {
    runOrCancelPinger($this);
    if (!(reasonToSend.i30_1 === Codes_CLOSED_ABNORMALLY_getInstance().e30_1)) {
      var tmp = $this.z30_1.r30().v21(Close.e32(reasonToSend), $completion);
      if (tmp === get_COROUTINE_SUSPENDED())
        tmp = yield tmp;
    }
  }finally {
    $this.b31_1.o1t(reasonToSend);
    if (!(exception == null)) {
      $this.f31_1.g22(exception);
      $this.e31_1.g22(exception);
    }
  }
  return Unit_instance;
}
function sendCloseSequence($this, reason, exception, $completion) {
  return suspendOrReturn(/*#__NOINLINE__*/_generator_sendCloseSequence__8ec8rh.bind(VOID, $this, reason, exception), $completion);
}
function sendCloseSequence$default($this, reason, exception, $completion, $super) {
  exception = exception === VOID ? null : exception;
  return sendCloseSequence($this, reason, exception, $completion);
}
function tryClose($this) {
  return $this.g31_1.atomicfu$compareAndSet(false, true);
}
function runOrCancelPinger($this) {
  var interval = $this.j31_1;
  var tmp;
  if ($this.g31_1.kotlinx$atomicfu$value) {
    tmp = null;
  } else if (interval > 0n) {
    var tmp_0 = $this.z30_1.r30();
    var tmp_1 = $this.k31_1;
    tmp = pinger($this, tmp_0, interval, tmp_1, DefaultWebSocketSessionImpl$runOrCancelPinger$slambda_0($this));
  } else {
    tmp = null;
  }
  var newPinger = tmp;
  var tmp0_safe_receiver = $this.a31_1.atomicfu$getAndSet(newPinger);
  if (tmp0_safe_receiver == null)
    null;
  else
    tmp0_safe_receiver.i22();
  var tmp2_safe_receiver = newPinger == null ? null : new ChannelResult(newPinger.w21(Companion_getInstance_0().h32_1));
  if (tmp2_safe_receiver == null)
    null;
  else
    _ChannelResult___get_isSuccess__impl__odq1z9(tmp2_safe_receiver.u21_1);
  if ($this.g31_1.kotlinx$atomicfu$value && !(newPinger == null)) {
    runOrCancelPinger($this);
  }
}
function *_generator_checkMaxFrameSize__26jxa6($this, packet, frame, $completion) {
  var tmp = frame.q31_1.length;
  var tmp1_elvis_lhs = packet == null ? null : get_size(packet);
  var size = tmp + (tmp1_elvis_lhs == null ? 0 : tmp1_elvis_lhs) | 0;
  if (fromInt(size) > $this.p30()) {
    if (packet == null)
      null;
    else {
      packet.e7();
    }
    var tmp_0 = close($this, CloseReason.l30(Codes_TOO_BIG_getInstance(), 'Frame is too big: ' + size + '. Max size is ' + $this.p30().toString()), $completion);
    if (tmp_0 === get_COROUTINE_SUSPENDED())
      tmp_0 = yield tmp_0;
    throw FrameTooBigException.l32(fromInt(size));
  }
  return Unit_instance;
}
function checkMaxFrameSize($this, packet, frame, $completion) {
  return suspendOrReturn(/*#__NOINLINE__*/_generator_checkMaxFrameSize__26jxa6.bind(VOID, $this, packet, frame), $completion);
}
function processIncomingExtensions($this, frame) {
  // Inline function 'kotlin.collections.fold' call
  var accumulator = frame;
  var _iterator__ex2g4s = $this.m32().q1();
  while (_iterator__ex2g4s.r1()) {
    var element = _iterator__ex2g4s.s1();
    var current = accumulator;
    accumulator = element.n32(current);
  }
  return accumulator;
}
function processOutgoingExtensions($this, frame) {
  // Inline function 'kotlin.collections.fold' call
  var accumulator = frame;
  var _iterator__ex2g4s = $this.m32().q1();
  while (_iterator__ex2g4s.r1()) {
    var element = _iterator__ex2g4s.s1();
    var current = accumulator;
    accumulator = element.o32(current);
  }
  return accumulator;
}
var Companion_instance_0;
function Companion_getInstance_0() {
  if (Companion_instance_0 === VOID)
    new Companion_0();
  return Companion_instance_0;
}
function DefaultWebSocketSessionImpl$start$slambda_0($incomingJob, $outgoingJob, this$0) {
  var i = new DefaultWebSocketSessionImpl$start$slambda($incomingJob, $outgoingJob, this$0);
  var l = ($this$launch, $completion) => i.l29($this$launch, $completion);
  l.$arity = 1;
  return l;
}
function DefaultWebSocketSessionImpl$runIncomingProcessor$slambda_0(this$0, $ponger) {
  var i = new DefaultWebSocketSessionImpl$runIncomingProcessor$slambda(this$0, $ponger);
  var l = ($this$launch, $completion) => i.l29($this$launch, $completion);
  l.$arity = 1;
  return l;
}
function DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda_0(this$0) {
  var i = new DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda(this$0);
  var l = ($this$launch, $completion) => i.l29($this$launch, $completion);
  l.$arity = 1;
  return l;
}
function DefaultWebSocketSessionImpl$runOrCancelPinger$slambda_0(this$0) {
  var i = new DefaultWebSocketSessionImpl$runOrCancelPinger$slambda(this$0);
  var l = (it, $completion) => i.x32(it, $completion);
  l.$arity = 1;
  return l;
}
var properties_initialized_DefaultWebSocketSession_kt_6cjlhc;
function _init_properties_DefaultWebSocketSession_kt__469s0y() {
  if (!properties_initialized_DefaultWebSocketSession_kt_6cjlhc) {
    properties_initialized_DefaultWebSocketSession_kt_6cjlhc = true;
    LOGGER = KtorSimpleLogger('io.ktor.websocket.WebSocket');
    IncomingProcessorCoroutineName = new CoroutineName('ws-incoming-processor');
    OutgoingProcessorCoroutineName = new CoroutineName('ws-outgoing-processor');
    NORMAL_CLOSE = CloseReason.l30(Codes_NORMAL_getInstance(), 'OK');
    var tmp0_safe_receiver = get_OUTGOING_CHANNEL_CAPACITY();
    var tmp;
    if (tmp0_safe_receiver == null) {
      tmp = null;
    } else {
      // Inline function 'kotlin.let' call
      tmp = new ChannelConfig(tmp0_safe_receiver, ChannelOverflow_SUSPEND_getInstance());
    }
    OUTGOING_CHANNEL_CONFIG = tmp;
  }
}
function readText_0(_this__u8e3s4) {
  // Inline function 'kotlin.require' call
  if (!_this__u8e3s4.o31_1) {
    var message = 'Text could be only extracted from non-fragmented frame';
    throw IllegalArgumentException.m2(toString(message));
  }
  var tmp = Charsets_getInstance().i2a_1.m2a();
  // Inline function 'io.ktor.utils.io.core.buildPacket' call
  var builder = new Buffer();
  writeFully(builder, _this__u8e3s4.q31_1);
  return decode(tmp, builder);
}
function readBytes(_this__u8e3s4) {
  // Inline function 'kotlin.collections.copyOf' call
  // Inline function 'kotlin.js.asDynamic' call
  return _this__u8e3s4.q31_1.slice();
}
function readReason(_this__u8e3s4) {
  if (_this__u8e3s4.q31_1.length < 2) {
    return null;
  }
  // Inline function 'io.ktor.utils.io.core.buildPacket' call
  var builder = new Buffer();
  writeFully(builder, _this__u8e3s4.q31_1);
  var packet = builder;
  var code = packet.w1j();
  var message = readText(packet);
  return CloseReason.k30(code, message);
}
var NonDisposableHandle_instance;
function NonDisposableHandle_getInstance() {
  return NonDisposableHandle_instance;
}
var FrameType_TEXT_instance;
var FrameType_BINARY_instance;
var FrameType_CLOSE_instance;
var FrameType_PING_instance;
var FrameType_PONG_instance;
var Companion_instance_1;
function Companion_getInstance_1() {
  FrameType_initEntries();
  if (Companion_instance_1 === VOID)
    new Companion_1();
  return Companion_instance_1;
}
function values_0() {
  return [FrameType_TEXT_getInstance(), FrameType_BINARY_getInstance(), FrameType_CLOSE_getInstance(), FrameType_PING_getInstance(), FrameType_PONG_getInstance()];
}
function get_entries_0() {
  if ($ENTRIES_0 == null)
    $ENTRIES_0 = enumEntries(values_0());
  return $ENTRIES_0;
}
var FrameType_entriesInitialized;
function FrameType_initEntries() {
  if (FrameType_entriesInitialized)
    return Unit_instance;
  FrameType_entriesInitialized = true;
  FrameType_TEXT_instance = new FrameType('TEXT', 0, false, 1);
  FrameType_BINARY_instance = new FrameType('BINARY', 1, false, 2);
  FrameType_CLOSE_instance = new FrameType('CLOSE', 2, true, 8);
  FrameType_PING_instance = new FrameType('PING', 3, true, 9);
  FrameType_PONG_instance = new FrameType('PONG', 4, true, 10);
  Companion_getInstance_1();
}
var $ENTRIES_0;
function FrameType_TEXT_getInstance() {
  FrameType_initEntries();
  return FrameType_TEXT_instance;
}
function FrameType_BINARY_getInstance() {
  FrameType_initEntries();
  return FrameType_BINARY_instance;
}
function FrameType_CLOSE_getInstance() {
  FrameType_initEntries();
  return FrameType_CLOSE_instance;
}
function FrameType_PING_getInstance() {
  FrameType_initEntries();
  return FrameType_PING_instance;
}
function FrameType_PONG_getInstance() {
  FrameType_initEntries();
  return FrameType_PONG_instance;
}
function get_PongerCoroutineName() {
  _init_properties_PingPong_kt__9aqxey();
  return PongerCoroutineName;
}
var PongerCoroutineName;
function get_PingerCoroutineName() {
  _init_properties_PingPong_kt__9aqxey();
  return PingerCoroutineName;
}
var PingerCoroutineName;
function ponger(_this__u8e3s4, outgoing) {
  _init_properties_PingPong_kt__9aqxey();
  var channel = Channel(5);
  var tmp = get_PongerCoroutineName();
  launch(_this__u8e3s4, tmp, VOID, ponger$slambda_0(channel, outgoing));
  return channel;
}
function pinger(_this__u8e3s4, outgoing, periodMillis, timeoutMillis, onTimeout) {
  _init_properties_PingPong_kt__9aqxey();
  var actorJob = Job();
  var channel = Channel(2147483647);
  var tmp = actorJob.qm(get_PingerCoroutineName());
  launch(_this__u8e3s4, tmp, VOID, pinger$slambda_0(periodMillis, timeoutMillis, onTimeout, channel, outgoing));
  var tmp_0 = ensureNotNull(_this__u8e3s4.c1n().md(Key_instance));
  tmp_0.e1o(pinger$lambda(actorJob));
  return channel;
}
function *_generator_invoke__zhh2q8_3($this, $this$launch, $completion) {
  try {
    // Inline function 'kotlinx.coroutines.channels.consumeEach' call
    var tmp0 = $this.e33_1;
    $l$block: {
      // Inline function 'kotlinx.coroutines.channels.consume' call
      var cause = null;
      try {
        var _iterator__ex2g4s = tmp0.q1();
        $l$loop: while (true) {
          var tmp = _iterator__ex2g4s.h21($completion);
          if (tmp === get_COROUTINE_SUSPENDED())
            tmp = yield tmp;
          if (!tmp) {
            break $l$loop;
          }
          var e = _iterator__ex2g4s.s1();
          get_LOGGER().j2h('Received ping message, sending pong message');
          var tmp_0 = $this.f33_1.v21(Pong.w32(e.q31_1), $completion);
          if (tmp_0 === get_COROUTINE_SUSPENDED())
            tmp_0 = yield tmp_0;
        }
        break $l$block;
      } catch ($p) {
        if ($p instanceof Error) {
          var e_0 = $p;
          cause = e_0;
          throw e_0;
        } else {
          throw $p;
        }
      }
      finally {
        cancelConsumed(tmp0, cause);
      }
    }
  } catch ($p) {
    if ($p instanceof ClosedSendChannelException) {
      var _unused_var__etf5q3 = $p;
    } else {
      throw $p;
    }
  }
  return Unit_instance;
}
function ponger$slambda_0($channel, $outgoing) {
  var i = new ponger$slambda($channel, $outgoing);
  var l = ($this$launch, $completion) => i.l29($this$launch, $completion);
  l.$arity = 1;
  return l;
}
function *_generator_invoke__zhh2q8_4($this, $this$withTimeoutOrNull, $completion) {
  while (true) {
    var tmp = $this.g33_1.z21($completion);
    if (tmp === get_COROUTINE_SUSPENDED())
      tmp = yield tmp;
  }
  return Unit_instance;
}
function *_generator_invoke__zhh2q8_5($this, $this$withTimeoutOrNull, $completion) {
  get_LOGGER().j2h('WebSocket Pinger: sending ping frame');
  var tmp = $this.h33_1.v21(Ping.r33(toByteArray($this.i33_1, Charsets_getInstance().j2a_1)), $completion);
  if (tmp === get_COROUTINE_SUSPENDED())
    tmp = yield tmp;
  $l$loop: while (true) {
    var tmp_0 = $this.j33_1.z21($completion);
    if (tmp_0 === get_COROUTINE_SUSPENDED())
      tmp_0 = yield tmp_0;
    var msg = tmp_0;
    if (decodeToString(msg.q31_1, 0, 0 + msg.q31_1.length | 0) === $this.i33_1) {
      get_LOGGER().j2h('WebSocket Pinger: received valid pong frame ' + msg.toString());
      break $l$loop;
    }
    get_LOGGER().j2h('WebSocket Pinger: received invalid pong frame ' + msg.toString() + ', continue waiting');
  }
  return Unit_instance;
}
function *_generator_invoke__zhh2q8_6($this, $this$launch, $completion) {
  get_LOGGER().j2h('Starting WebSocket pinger coroutine with period ' + $this.s33_1.toString() + ' ms and timeout ' + $this.t33_1.toString() + ' ms');
  var random = Random(getTimeMillis());
  var pingIdBytes = new Int8Array(32);
  try {
    $l$loop: while (true) {
      var tmp = withTimeoutOrNull($this.s33_1, pinger$slambda$slambda_1($this.v33_1), $completion);
      if (tmp === get_COROUTINE_SUSPENDED())
        tmp = yield tmp;
      random.qo(pingIdBytes);
      var pingMessage = '[ping ' + hex(pingIdBytes) + ' ping]';
      var tmp_0 = withTimeoutOrNull($this.t33_1, pinger$slambda$slambda_2($this.w33_1, pingMessage, $this.v33_1), $completion);
      if (tmp_0 === get_COROUTINE_SUSPENDED())
        tmp_0 = yield tmp_0;
      var rc = tmp_0;
      if (rc == null) {
        get_LOGGER().j2h('WebSocket pinger has timed out');
        var tmp_1 = $this.u33_1(CloseReason.l30(Codes_INTERNAL_ERROR_getInstance(), 'Ping timeout'), $completion);
        if (tmp_1 === get_COROUTINE_SUSPENDED())
          tmp_1 = yield tmp_1;
        break $l$loop;
      }
    }
  } catch ($p) {
    if ($p instanceof CancellationException) {
      var ignore = $p;
    } else {
      if ($p instanceof ClosedReceiveChannelException) {
        var ignore_0 = $p;
      } else {
        if ($p instanceof ClosedSendChannelException) {
          var ignore_1 = $p;
        } else {
          if ($p instanceof ClosedByteChannelException) {
            var ignore_2 = $p;
          } else {
            throw $p;
          }
        }
      }
    }
  }
  return Unit_instance;
}
function pinger$slambda$slambda_1($channel) {
  var i = new pinger$slambda$slambda($channel);
  var l = ($this$withTimeoutOrNull, $completion) => i.l29($this$withTimeoutOrNull, $completion);
  l.$arity = 1;
  return l;
}
function pinger$slambda$slambda_2($outgoing, $pingMessage, $channel) {
  var i = new pinger$slambda$slambda_0($outgoing, $pingMessage, $channel);
  var l = ($this$withTimeoutOrNull, $completion) => i.l29($this$withTimeoutOrNull, $completion);
  l.$arity = 1;
  return l;
}
function pinger$slambda_0($periodMillis, $timeoutMillis, $onTimeout, $channel, $outgoing) {
  var i = new pinger$slambda($periodMillis, $timeoutMillis, $onTimeout, $channel, $outgoing);
  var l = ($this$launch, $completion) => i.l29($this$launch, $completion);
  l.$arity = 1;
  return l;
}
function pinger$lambda($actorJob) {
  return (it) => {
    $actorJob.m1o();
    return Unit_instance;
  };
}
var properties_initialized_PingPong_kt_fbfhmc;
function _init_properties_PingPong_kt__9aqxey() {
  if (!properties_initialized_PingPong_kt_fbfhmc) {
    properties_initialized_PingPong_kt_fbfhmc = true;
    PongerCoroutineName = new CoroutineName('ws-ponger');
    PingerCoroutineName = new CoroutineName('ws-pinger');
  }
}
var Companion_instance_2;
function Companion_getInstance_2() {
  if (Companion_instance_2 === VOID)
    new Companion_2();
  return Companion_instance_2;
}
function from(_this__u8e3s4, config) {
  // Inline function 'kotlin.with' call
  var tmp;
  if (config.z33_1 === 2147483647) {
    tmp = Channel(2147483647);
  } else if (config.a34_1.equals(ChannelOverflow_SUSPEND_getInstance())) {
    tmp = Channel(config.z33_1, BufferOverflow_SUSPEND_getInstance());
  } else if (config.a34_1.equals(ChannelOverflow_CLOSE_getInstance())) {
    tmp = new BoundedChannel(config.z33_1);
  } else {
    var message = 'Unsupported channel config.';
    throw IllegalStateException.o(toString(message));
  }
  return tmp;
}
var Companion_instance_3;
function Companion_getInstance_3() {
  if (Companion_instance_3 === VOID)
    new Companion_3();
  return Companion_instance_3;
}
var ChannelOverflow_SUSPEND_instance;
var ChannelOverflow_CLOSE_instance;
var ChannelOverflow_entriesInitialized;
function ChannelOverflow_initEntries() {
  if (ChannelOverflow_entriesInitialized)
    return Unit_instance;
  ChannelOverflow_entriesInitialized = true;
  ChannelOverflow_SUSPEND_instance = new ChannelOverflow('SUSPEND', 0);
  ChannelOverflow_CLOSE_instance = new ChannelOverflow('CLOSE', 1);
}
function BoundedChannel$Companion$createDelegate$lambda($channel) {
  return (it) => {
    var tmp;
    var tmp_0;
    if ($channel._v == null) {
      throwUninitializedPropertyAccessException('channel');
    } else {
      tmp_0 = $channel._v;
    }
    if (!tmp_0.o21()) {
      var tmp_1;
      if ($channel._v == null) {
        throwUninitializedPropertyAccessException('channel');
      } else {
        tmp_1 = $channel._v;
      }
      tmp_1.g22(ChannelOverflowException.f34('Channel overflowed'));
      tmp = Unit_instance;
    }
    return Unit_instance;
  };
}
var Companion_instance_4;
function Companion_getInstance_4() {
  return Companion_instance_4;
}
function *_generator_send__qhx0g0($this, element, $completion) {
  var tmp = $this.h34_1.v21(element, $completion);
  if (tmp === get_COROUTINE_SUSPENDED())
    tmp = yield tmp;
  return Unit_instance;
}
function ChannelOverflow_SUSPEND_getInstance() {
  ChannelOverflow_initEntries();
  return ChannelOverflow_SUSPEND_instance;
}
function ChannelOverflow_CLOSE_getInstance() {
  ChannelOverflow_initEntries();
  return ChannelOverflow_CLOSE_instance;
}
function parametersToString($this) {
  return $this.p34_1.o1() ? '' : '; ' + joinToString($this.p34_1, ';');
}
function parseWebSocketExtensions(value) {
  // Inline function 'kotlin.collections.map' call
  var this_0 = split(value, [',']);
  // Inline function 'kotlin.collections.mapTo' call
  var destination = ArrayList.d2(collectionSizeOrDefault(this_0, 10));
  var _iterator__ex2g4s = this_0.q1();
  while (_iterator__ex2g4s.r1()) {
    var item = _iterator__ex2g4s.s1();
    var extension = split(item, [';']);
    // Inline function 'kotlin.text.trim' call
    var this_1 = first(extension);
    var name = toString(trim(isCharSequence(this_1) ? this_1 : THROW_CCE()));
    // Inline function 'kotlin.collections.map' call
    var this_2 = drop(extension, 1);
    // Inline function 'kotlin.collections.mapTo' call
    var destination_0 = ArrayList.d2(collectionSizeOrDefault(this_2, 10));
    var _iterator__ex2g4s_0 = this_2.q1();
    while (_iterator__ex2g4s_0.r1()) {
      var item_0 = _iterator__ex2g4s_0.s1();
      // Inline function 'kotlin.text.trim' call
      var tmp$ret$2 = toString(trim(isCharSequence(item_0) ? item_0 : THROW_CCE()));
      destination_0.e2(tmp$ret$2);
    }
    var parameters = destination_0;
    var tmp$ret$5 = new WebSocketExtensionHeader(name, parameters);
    destination.e2(tmp$ret$5);
  }
  return destination;
}
function *_generator_send__qhx0g0_0($this, frame, $completion) {
  var tmp = $this.r30().v21(frame, $completion);
  if (tmp === get_COROUTINE_SUSPENDED())
    tmp = yield tmp;
  return Unit_instance;
}
function *_generator_close__nh2uv0(_this__u8e3s4, reason, $completion) {
  try {
    var tmp = _this__u8e3s4.s30(Close.e32(reason), $completion);
    if (tmp === get_COROUTINE_SUSPENDED())
      tmp = yield tmp;
    var tmp_0 = _this__u8e3s4.n27($completion);
    if (tmp_0 === get_COROUTINE_SUSPENDED())
      tmp_0 = yield tmp_0;
  } catch ($p) {
    if ($p instanceof Error) {
      var _unused_var__etf5q3 = $p;
    } else {
      throw $p;
    }
  }
  return Unit_instance;
}
function close(_this__u8e3s4, reason, $completion) {
  reason = reason === VOID ? CloseReason.l30(Codes_NORMAL_getInstance(), '') : reason;
  return suspendOrReturn(/*#__NOINLINE__*/_generator_close__nh2uv0.bind(VOID, _this__u8e3s4, reason), $completion);
}
function *_generator_closeExceptionally__hurwhz(_this__u8e3s4, cause, $completion) {
  var tmp;
  if (cause instanceof CancellationException) {
    tmp = CloseReason.l30(Codes_NORMAL_getInstance(), '');
  } else {
    tmp = CloseReason.l30(Codes_INTERNAL_ERROR_getInstance(), cause.toString());
  }
  var reason = tmp;
  var tmp_0 = close(_this__u8e3s4, reason, $completion);
  if (tmp_0 === get_COROUTINE_SUSPENDED())
    tmp_0 = yield tmp_0;
  return Unit_instance;
}
function closeExceptionally(_this__u8e3s4, cause, $completion) {
  return suspendOrReturn(/*#__NOINLINE__*/_generator_closeExceptionally__hurwhz.bind(VOID, _this__u8e3s4, cause), $completion);
}
var Companion_instance_5;
function Companion_getInstance_5() {
  if (Companion_instance_5 === VOID)
    new Companion_5();
  return Companion_instance_5;
}
function get_OUTGOING_CHANNEL_CAPACITY() {
  return OUTGOING_CHANNEL_CAPACITY;
}
var OUTGOING_CHANNEL_CAPACITY;
//region block: post-declaration
initMetadataForCompanion(Companion);
initMetadataForClass(Codes, 'Codes');
initMetadataForClass(CloseReason, 'CloseReason');
initMetadataForInterface(WebSocketSession, 'WebSocketSession', VOID, VOID, [CoroutineScope], [1, 0]);
initMetadataForInterface(DefaultWebSocketSession, 'DefaultWebSocketSession', VOID, VOID, [WebSocketSession], [1, 0]);
initMetadataForCompanion(Companion_0);
initMetadataForLambda(DefaultWebSocketSessionImpl$start$slambda, VOID, VOID, [1]);
initMetadataForLambda(DefaultWebSocketSessionImpl$runIncomingProcessor$slambda, VOID, VOID, [1]);
initMetadataForLambda(DefaultWebSocketSessionImpl$runOutgoingProcessor$slambda, VOID, VOID, [1]);
initMetadataForLambda(DefaultWebSocketSessionImpl$runOrCancelPinger$slambda, VOID, VOID, [1]);
protoOf(DefaultWebSocketSessionImpl).s30 = send;
initMetadataForClass(DefaultWebSocketSessionImpl, 'DefaultWebSocketSessionImpl', VOID, VOID, [DefaultWebSocketSession, WebSocketSession], [1, 0, 2]);
initMetadataForObject(NonDisposableHandle, 'NonDisposableHandle');
initMetadataForClass(FrameTooBigException, 'FrameTooBigException', VOID, VOID, [Exception, CopyableThrowable]);
initMetadataForCompanion(Companion_1);
initMetadataForClass(FrameType, 'FrameType');
initMetadataForLambda(ponger$slambda, VOID, VOID, [1]);
initMetadataForLambda(pinger$slambda$slambda, VOID, VOID, [1]);
initMetadataForLambda(pinger$slambda$slambda_0, VOID, VOID, [1]);
initMetadataForLambda(pinger$slambda, VOID, VOID, [1]);
initMetadataForCompanion(Companion_2);
initMetadataForClass(WebSocketChannelsConfig, 'WebSocketChannelsConfig', WebSocketChannelsConfig);
initMetadataForCompanion(Companion_3);
initMetadataForClass(ChannelConfig, 'ChannelConfig');
initMetadataForClass(ChannelOverflow, 'ChannelOverflow');
initMetadataForCompanion(Companion_4);
protoOf(BoundedChannel).i22 = close$default;
protoOf(BoundedChannel).k22 = cancel$default;
initMetadataForClass(BoundedChannel, 'BoundedChannel', VOID, VOID, [SendChannel, ReceiveChannel], [1, 0]);
initMetadataForClass(ChannelOverflowException, 'ChannelOverflowException');
initMetadataForInterface(WebSocketExtension, 'WebSocketExtension');
initMetadataForClass(WebSocketExtensionsConfig, 'WebSocketExtensionsConfig', WebSocketExtensionsConfig);
initMetadataForClass(WebSocketExtensionHeader, 'WebSocketExtensionHeader');
initMetadataForClass(Frame, 'Frame');
initMetadataForClass(Binary, 'Binary');
initMetadataForClass(Text, 'Text');
initMetadataForClass(Close, 'Close', Close.m35);
initMetadataForClass(Ping, 'Ping');
initMetadataForClass(Pong, 'Pong');
initMetadataForCompanion(Companion_5);
//endregion
//region block: init
NonDisposableHandle_instance = new NonDisposableHandle();
Companion_instance_4 = new Companion_4();
OUTGOING_CHANNEL_CAPACITY = null;
//endregion
//region block: exports
export {
  Codes_CLOSED_ABNORMALLY_getInstance as Codes_CLOSED_ABNORMALLY_getInstance18g5hbbmrws6x,
  Codes_NORMAL_getInstance as Codes_NORMAL_getInstance21orcjign6rr6,
  send as send3oe3simbzresd,
  close as close1my1iwn6t9rqe,
  Companion_getInstance as Companion_getInstance3h3c6jlu8qefd,
  Companion_getInstance_2 as Companion_getInstance1onda8f6dyvl,
  CloseReason as CloseReason10cphaqpp3ct7,
  DefaultWebSocketSession_0 as DefaultWebSocketSessionmehckluw85jl,
  DefaultWebSocketSession as DefaultWebSocketSession3h8506yqzs5fx,
  Binary as Binary3tlzyfojm51s4,
  Close as Close3tx65evcwi73t,
  Text as Text3e6ukp9joohql,
  WebSocketChannelsConfig as WebSocketChannelsConfig1qogztyrywmj9,
  WebSocketExtensionsConfig as WebSocketExtensionsConfig3sf1f7u7xi63m,
  WebSocketExtension as WebSocketExtensionixqq2y77p4e0,
  WebSocketSession as WebSocketSessionzi1ianvyj32u,
  from as from3gpkuvfyl3bft,
  parseWebSocketExtensions as parseWebSocketExtensionszyo25w86ylog,
  readBytes as readBytes28s4uf7ekyufa,
  readText_0 as readText30p9xkeoodw49,
};
//endregion

//# sourceMappingURL=ktor-ktor-websockets.mjs.map
